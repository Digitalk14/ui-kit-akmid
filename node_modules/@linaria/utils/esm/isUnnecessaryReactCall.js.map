{"version":3,"file":"isUnnecessaryReactCall.js","names":["collectExportsAndImports","getCallee","p","callee","get","isSequenceExpression","expressions","length","isNumericLiteral","value","JSXRuntimeSource","isJSXRuntime","imports","jsxRuntime","find","i","source","jsxRuntimeName","local","isIdentifier","node","name","isMemberExpression","isHookOrCreateElement","test","isClassicReactRuntime","reactImports","filter","imported","bindingPath","scope","getBinding","path","some","isAncestor","object","property","defaultImport","isUnnecessaryReactCall","programPath","findParent","isProgram"],"sources":["../src/isUnnecessaryReactCall.ts"],"sourcesContent":["import type { NodePath } from '@babel/core';\nimport type { CallExpression } from '@babel/types';\n\nimport type { IImport, ISideEffectImport } from './collectExportsAndImports';\nimport collectExportsAndImports from './collectExportsAndImports';\n\nfunction getCallee(p: NodePath<CallExpression>) {\n  const callee = p.get('callee');\n  if (callee.isSequenceExpression()) {\n    const expressions = callee.get('expressions');\n    if (\n      expressions.length === 2 &&\n      expressions[0].isNumericLiteral({ value: 0 })\n    ) {\n      return expressions[1];\n    }\n\n    return callee;\n  }\n\n  return callee;\n}\n\nconst JSXRuntimeSource = 'react/jsx-runtime';\n\nfunction isJSXRuntime(\n  p: NodePath<CallExpression>,\n  imports: (IImport | ISideEffectImport)[]\n) {\n  const jsxRuntime = imports.find((i) => i.source === JSXRuntimeSource);\n  const jsxRuntimeName =\n    jsxRuntime?.local?.isIdentifier() && jsxRuntime?.local?.node?.name;\n\n  if (jsxRuntime) {\n    const callee = getCallee(p);\n    if (jsxRuntimeName && callee.isIdentifier({ name: jsxRuntimeName })) {\n      return true;\n    }\n\n    if (\n      callee.isMemberExpression() &&\n      imports.find((i) => i.source === JSXRuntimeSource && i.local === callee)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction isHookOrCreateElement(name: string): boolean {\n  return name === 'createElement' || /use[A-Z]/.test(name);\n}\n\nfunction isClassicReactRuntime(\n  p: NodePath<CallExpression>,\n  imports: (IImport | ISideEffectImport)[]\n) {\n  const reactImports = imports.filter(\n    (i) =>\n      i.source === 'react' &&\n      (i.imported === 'default' ||\n        (i.imported && isHookOrCreateElement(i.imported)))\n  ) as IImport[];\n\n  if (reactImports.length === 0) return false;\n  const callee = getCallee(p);\n  if (callee.isIdentifier() && isHookOrCreateElement(callee.node.name)) {\n    const bindingPath = callee.scope.getBinding(callee.node.name)?.path;\n    return reactImports.some((i) => bindingPath?.isAncestor(i.local));\n  }\n\n  if (callee.isMemberExpression()) {\n    if (reactImports.some((i) => i.local === callee)) {\n      // It's React.createElement in CJS\n      return true;\n    }\n\n    const object = callee.get('object');\n    const property = callee.get('property');\n    const defaultImport = reactImports.find((i) => i.imported === 'default');\n    if (\n      !defaultImport ||\n      !defaultImport.local.isIdentifier() ||\n      !property.isIdentifier() ||\n      !isHookOrCreateElement(property.node.name) ||\n      !object.isIdentifier({ name: defaultImport.local.node.name })\n    ) {\n      return false;\n    }\n\n    const bindingPath = object.scope.getBinding(object.node.name)?.path;\n    return bindingPath?.isAncestor(defaultImport.local) ?? false;\n  }\n\n  return false;\n}\n\nexport default function isUnnecessaryReactCall(path: NodePath<CallExpression>) {\n  const programPath = path.findParent((p) => p.isProgram());\n  if (!programPath) {\n    return false;\n  }\n\n  const { imports } = collectExportsAndImports(programPath);\n\n  return isJSXRuntime(path, imports) || isClassicReactRuntime(path, imports);\n}\n"],"mappings":"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"}